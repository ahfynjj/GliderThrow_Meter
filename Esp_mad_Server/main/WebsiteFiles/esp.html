<!DOCTYPE html>

<html lang="zh-CN">

    <head>
  
        <meta charset="utf-8">

        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <!-- Boostrap and jquery link -->
        <link rel="stylesheet" href="bootstrap.min.css" />
        <script src="jquery-3.3.1.min.js"></script>       
        <script src="bootstrap.min.js"></script>  
                     
        <title>ANEG 舵面量角器</title>

    </head>

    <body>

        <!-- A nice jumbotron for the page header -->
        <div class="col-lg-12">
            <div class="jumbotron">
                <h1 style="font-size:100px">舵面量角器</h1><span style="font-size:50px">最简单的滑翔机调参方式</span>
            </div>
        </div>

        <!-- Navigation bar with three option : Travel, angle and setting -->
        <div class="col-lg-12">    
            <nav class="navbar navbar-default" style="font-size:50px">
                <ul class="nav nav-tabs">
                    <li><a class="nav-item nav-link active" href="#p1" data-toggle="tab">行程</a></li>
                    <li><a class="nav-item nav-link" href="#p2" data-toggle="tab">角度</a></li>
                    <li><a class="nav-item nav-link" href="#p3" data-toggle="tab">设置</a></li>
                    <li><a class="nav-item nav-link" href="#p4" data-toggle="tab">信息</a></li>
                </ul>
            </nav>      
        </div>

        <div class="tab-content">
                
            <!--- Travel is the active tab-content per default -->
            <div class="tab-pane active" id="p1">     

                <div class="col-lg-12">                
                    <div style="background:linear-gradient(to right, #8f8e8e 0%,#706464 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">传感器 1</p>
                    </div>
                </div>             

                <div class="col-lg-12">                
                    <div style="background:linear-gradient(to right, #ff5db1 0%,#ef017c 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">行程：&nbsp;<span id="travel1" name="travel1"></span>
                        mm</p>
                    </div>
                </div>

                <div class="col-lg-12" >
                    <div style="background:linear-gradient(to right, #ff5db1 0%,#ef017c 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">最大上偏：&nbsp;<span id="maxiTravelSensor1" name="maxiTravelSensor1"></span>
                        mm</p>
                    </div>
                </div>          
                
                <div class="col-lg-12" >
                    <div style="background:linear-gradient(to right, #ff5db1 0%,#ef017c 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">最大下偏：&nbsp;<span id="miniTravelSensor1" name="miniTravelSensor1"></span>
                        mm</p>
                    </div>
                </div>   

                <br/>

                <div class="col-lg-12">                
                    <div style="background:linear-gradient(to right, #8f8e8e 0%,#706464 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">传感器 2</p>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div  style="background:linear-gradient(to right, #a9e4f7 0%,#0fb4e7 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">行程：&nbsp;<span id="travel2" name="travel2"></span>
                        mm</p>             
                    </div>
                </div>

                <div class="col-lg-12">
                    <div  style="background:linear-gradient(to right, #a9e4f7 0%,#0fb4e7 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">最大上偏：&nbsp;<span id="maxiTravelSensor2" name="maxiTravelSensor2"></span>
                        mm</p>             
                    </div>
                </div>                

                <div class="col-lg-12">
                    <div  style="background:linear-gradient(to right, #a9e4f7 0%,#0fb4e7 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">最大下偏：&nbsp;<span id="miniTravelSensor2" name="miniTravelSensor2"></span>
                        mm</p>             
                    </div>
                </div>     

                <br/>

                <div class="col-lg-12" >
                    <div style="background:linear-gradient(to right, #5ef59d 0%,#06d606 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">行程差值：&nbsp;<span id="DeltaTravel" name="DeltaTravel"></span>
                        mm</p>
                    </div>
                </div>

                <br/>
                <br/> 
                <br/>

                <div class="col text-center">                                             
                    <button type="button" style="background:linear-gradient(to right, #8f8e8e 0%,#706464 100%);border-radius:10px" 
                    id="resetSubmit" name="resetSubmit"><p class="text-center" style="color:white;font-size:50px">重置最大/最小</p></button>
                </div>

            </div>
            
            <!-- Angle tab-content -->
            <div class="tab-pane" id="p2">

                <div class="col-lg-12">
                    <div style="background:linear-gradient(to right, #ff5db1 0%,#ef017c 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">传感器 1 角度：&nbsp;<span id="angle1" name="angle1"></span>
                        度</p>
                    </div>
                </div>
                                
                <div class="col-lg-12">
                    <div style="background:linear-gradient(to right, #a9e4f7 0%,#0fb4e7 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">传感器 2 角度：&nbsp;<span id="angle2" name="angle2"></span>
                        度</p>
                    </div>
                </div>
                                
                <div class="col-lg-12">               
                    <div style="background:linear-gradient(to right, #5ef59d 0%,#06d606 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">角度差值：&nbsp;<span id="DeltaAngle" name="DeltaAngle"></span>
                        度</p>
                    </div>
                </div>
                
            </div>
                            
            <!-- setting tab-content -->
            <div class="tab-pane" id="p3">                
                <input class="col-lg-12" style="border-radius:10px;font-size:50px" type="number" min="1" step="1" id ="chordValue" name="chordValue" value="50" />
                                
                <button class="col-lg-12" style="border-radius:10px;font-size:50px;background-color:#33ff00" id="chordSubmit" name="chordSubmit">保存舵弦长度</button>
            </div>
            
            <!-- info tab-content -->
            <div class="tab-pane" id="p4">      

                <div class="col-lg-12">
                    <div style="background:linear-gradient(to right, #ff5db1 0%,#ef017c 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">传感器 1 电压：&nbsp;<span id="voltage1" name="voltage1"></span>
                        V</p>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div style="background:linear-gradient(to right, #a9e4f7 0%,#0fb4e7 100%);border-radius:10px">
                        <p class="text-center" style="color:white;font-size:50px">传感器 2 电压：&nbsp;<span id="voltage2" name="voltage2"></span>
                        V</p>
                    </div>
                </div>

            </div>

        </div>

        <!-- This script sent a periodical request to the esp32 http server -->
        <script>
            $(function() {

                setInterval(requestData, 1000);
                function requestData() {

                    $.ajax({url:"/sensors",cache:false})
                    .done(function(data) {
                        console.log(data);
                        var obj = JSON.parse(data);
                        if (data) {
                            $("#travel1").text(obj.travel1);
                            $("#travel2").text(obj.travel2);
                            $("#DeltaTravel").text(obj.DeltaTravel);                                                        
                            $("#angle1").text(obj.angle1);
                            $("#angle2").text(obj.angle2);
                            $("#DeltaAngle").text(obj.DeltaAngle);
                            $("#maxiTravelSensor1").text(obj.maxiTravelSensor1)
                            $("#miniTravelSensor1").text(obj.miniTravelSensor1)
                            $("#maxiTravelSensor2").text(obj.maxiTravelSensor2)
                            $("#miniTravelSensor2").text(obj.miniTravelSensor2)   
                            $("#voltage1").text(obj.voltage1) 
                            $("#voltage2").text(obj.voltage2)          
                        } else {
                            $("#travel1").text("?");
                            $("#travel2").text("?");
                            $("#DeltaTravel").text("?");                                                        
                            $("#angle1").text("?");
                            $("#angle2").text("?");
                            $("#DeltaAngle").text("?");
                            $("#maxiTravelSensor1").text("?"); 
                            $("#miniTravelSensor1").text("?");
                            $("#maxiTravelSensor2").text("?");
                            $("#miniTravelSensor2").text("?"); 
                            $("#voltage1").text("?");       
                            $("#voltage2").text("?");     
                        }
                    }).fail(function() {
                        console.log("获取数据时出现问题。");
                    });
                };
            });
        </script>

        <!-- This script deal with the ChordControlSurface value change -->
        <script>
            $(function() {
                $('#chordSubmit').click(function() {
                    var param = $("#chordValue").val();
                    $.post('/chord',{chordValue:param}, function(data){
                        alert(data);
                    });
                });  
            });
        </script>


        <!-- This script deal with the calibration -->
        <script>
            $(function() {
                $('#resetSubmit').click(function() {
                    $.post('/reset', function() {
                        alert("已将两路传感器的最大/最小值重置为 0");
                    }); 
                });
            });
        </script>

    </body>

</html>